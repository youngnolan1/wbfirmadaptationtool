)
ggsave("Mexico/output/BelowMedianEfficiency_AccessToFinance.png", plot, width = 12, height = 7, bg = "white")
df_stats <- master
df_stats <- master
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Size.png", plot, width = 12, height = 7, bg = "white")
# Age
age_counts <- df_stats %>%
filter(b5 >= 0) %>%
mutate(firm_age = year - b5) %>%
mutate(firm_age_bucket = case_when(
between(firm_age, 0, 5) ~ "0-5yrs",
between(firm_age, 6, 15) ~ "6-15yrs",
firm_age >= 16 ~ "Over 15yrs"
))
age_counts <- as.data.frame(table(age_counts$firm_age_bucket)) %>%
rename(Age = Var1) %>%
mutate(Prop = round((Freq/nrow(age_counts)) * 100))
plot <- ggplot(data = age_counts, aes(x = "", y = Prop, fill = Age)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Age, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("0-5yrs" = "#00BA38", "6-15yrs" = "#619CFF", "Over 15yrs" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Age.png", plot, width = 12, height = 7, bg = "white")
# Access to finance
access_to_finance_counts <- as.data.frame(table(df_stats$k30)) %>%
rename(AccessToFinance = Var1) %>%
mutate(AccessToFinance = case_when(
AccessToFinance == 0 ~ "No obstacle",
AccessToFinance == 1 ~ "Minor",
AccessToFinance == 2 ~ "Moderate",
AccessToFinance == 3 ~ "Major",
AccessToFinance == 4 ~ "Very severe"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = access_to_finance_counts, aes(x = "", y = Prop, fill = AccessToFinance)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(x = 1.2, label = paste0(AccessToFinance, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_AccessToFinance.png", plot, width = 12, height = 7, bg = "white")
ggsave("Mexico/output/BelowMedianEfficiency_Size.png", plot)
# Descriptive analysis - key characteristics of below-median efficiency firms
cutoff <- quantile(master$energy_inefficiency_elec, 0.75, na.rm = TRUE)
df_stats <- master %>%
filter(energy_inefficiency_elec > cutoff)
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_Size.png", plot)
?ggsave
# Descriptive analysis - key characteristics of below-median efficiency firms
cutoff <- quantile(master$energy_inefficiency_elec, 0.75, na.rm = TRUE)
df_stats <- master %>%
filter(energy_inefficiency_elec > cutoff)
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_Size.png", plot, w = 991, h = 564, units = "px", bg = "white")
# Age
age_counts <- df_stats %>%
filter(b5 >= 0) %>%
mutate(firm_age = year - b5) %>%
mutate(firm_age_bucket = case_when(
between(firm_age, 0, 5) ~ "0-5yrs",
between(firm_age, 6, 15) ~ "6-15yrs",
firm_age >= 16 ~ "Over 15yrs"
))
age_counts <- as.data.frame(table(age_counts$firm_age_bucket)) %>%
rename(Age = Var1) %>%
mutate(Prop = round((Freq/nrow(age_counts)) * 100))
plot <- ggplot(data = age_counts, aes(x = "", y = Prop, fill = Age)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Age, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("0-5yrs" = "#00BA38", "6-15yrs" = "#619CFF", "Over 15yrs" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_Age.png", w = 991, h = 564, units = "px", bg = "white")
# Access to finance
access_to_finance_counts <- as.data.frame(table(df_stats$k30)) %>%
rename(AccessToFinance = Var1) %>%
mutate(AccessToFinance = case_when(
AccessToFinance == 0 ~ "No obstacle",
AccessToFinance == 1 ~ "Minor",
AccessToFinance == 2 ~ "Moderate",
AccessToFinance == 3 ~ "Major",
AccessToFinance == 4 ~ "Very severe"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = access_to_finance_counts, aes(x = "", y = Prop, fill = AccessToFinance)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(x = 1.2, label = paste0(AccessToFinance, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_AccessToFinance.png", w = 991, h = 564, units = "px", bg = "white")
df_stats <- master
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Size.png", plot, w = 991, h = 564, units = "px", bg = "white")
# Age
age_counts <- df_stats %>%
filter(b5 >= 0) %>%
mutate(firm_age = year - b5) %>%
mutate(firm_age_bucket = case_when(
between(firm_age, 0, 5) ~ "0-5yrs",
between(firm_age, 6, 15) ~ "6-15yrs",
firm_age >= 16 ~ "Over 15yrs"
))
age_counts <- as.data.frame(table(age_counts$firm_age_bucket)) %>%
rename(Age = Var1) %>%
mutate(Prop = round((Freq/nrow(age_counts)) * 100))
plot <- ggplot(data = age_counts, aes(x = "", y = Prop, fill = Age)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Age, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("0-5yrs" = "#00BA38", "6-15yrs" = "#619CFF", "Over 15yrs" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Age.png", plot, w = 991, h = 564, units = "px", bg = "white")
# Access to finance
access_to_finance_counts <- as.data.frame(table(df_stats$k30)) %>%
rename(AccessToFinance = Var1) %>%
mutate(AccessToFinance = case_when(
AccessToFinance == 0 ~ "No obstacle",
AccessToFinance == 1 ~ "Minor",
AccessToFinance == 2 ~ "Moderate",
AccessToFinance == 3 ~ "Major",
AccessToFinance == 4 ~ "Very severe"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = access_to_finance_counts, aes(x = "", y = Prop, fill = AccessToFinance)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(x = 1.2, label = paste0(AccessToFinance, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_AccessToFinance.png", plot, w = 991, h = 564, units = "px", bg = "white")
# Descriptive analysis - key characteristics of below-median efficiency firms
cutoff <- quantile(master$energy_inefficiency_elec, 0.75, na.rm = TRUE)
df_stats <- master %>%
filter(energy_inefficiency_elec > cutoff)
# Create pies
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_Size.png", plot, w = 1200, h = 800, units = "px", bg = "white")
# Age
age_counts <- df_stats %>%
filter(b5 >= 0) %>%
mutate(firm_age = year - b5) %>%
mutate(firm_age_bucket = case_when(
between(firm_age, 0, 5) ~ "0-5yrs",
between(firm_age, 6, 15) ~ "6-15yrs",
firm_age >= 16 ~ "Over 15yrs"
))
age_counts <- as.data.frame(table(age_counts$firm_age_bucket)) %>%
rename(Age = Var1) %>%
mutate(Prop = round((Freq/nrow(age_counts)) * 100))
plot <- ggplot(data = age_counts, aes(x = "", y = Prop, fill = Age)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Age, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("0-5yrs" = "#00BA38", "6-15yrs" = "#619CFF", "Over 15yrs" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_Age.png", w = 1200, h = 800, units = "px", bg = "white")
# Access to finance
access_to_finance_counts <- as.data.frame(table(df_stats$k30)) %>%
rename(AccessToFinance = Var1) %>%
mutate(AccessToFinance = case_when(
AccessToFinance == 0 ~ "No obstacle",
AccessToFinance == 1 ~ "Minor",
AccessToFinance == 2 ~ "Moderate",
AccessToFinance == 3 ~ "Major",
AccessToFinance == 4 ~ "Very severe"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = access_to_finance_counts, aes(x = "", y = Prop, fill = AccessToFinance)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(x = 1.2, label = paste0(AccessToFinance, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/BelowMedianEfficiency_AccessToFinance.png", w = 1200, h = 800, units = "px", bg = "white")
# ALL FIRMS
df_stats <- master
# Size
size_counts <- as.data.frame(table(df_stats$size)) %>%
rename(Size = Var1) %>%
mutate(Size = case_when(
Size == 1 ~ "Small",
Size == 2 ~ "Medium",
Size == 3 ~ "Large"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = size_counts, aes(x = "", y = Prop, fill = Size)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Size, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("Small" = "#00BA38", "Medium" = "#619CFF", "Large" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Size.png", plot, w = 1200, h = 800, units = "px", bg = "white")
# Age
age_counts <- df_stats %>%
filter(b5 >= 0) %>%
mutate(firm_age = year - b5) %>%
mutate(firm_age_bucket = case_when(
between(firm_age, 0, 5) ~ "0-5yrs",
between(firm_age, 6, 15) ~ "6-15yrs",
firm_age >= 16 ~ "Over 15yrs"
))
age_counts <- as.data.frame(table(age_counts$firm_age_bucket)) %>%
rename(Age = Var1) %>%
mutate(Prop = round((Freq/nrow(age_counts)) * 100))
plot <- ggplot(data = age_counts, aes(x = "", y = Prop, fill = Age)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(label = paste0(Age, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
scale_fill_manual(values = c("0-5yrs" = "#00BA38", "6-15yrs" = "#619CFF", "Over 15yrs" = "#F8766D")) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_Age.png", plot, w = 1200, h = 800, units = "px", bg = "white")
# Access to finance
access_to_finance_counts <- as.data.frame(table(df_stats$k30)) %>%
rename(AccessToFinance = Var1) %>%
mutate(AccessToFinance = case_when(
AccessToFinance == 0 ~ "No obstacle",
AccessToFinance == 1 ~ "Minor",
AccessToFinance == 2 ~ "Moderate",
AccessToFinance == 3 ~ "Major",
AccessToFinance == 4 ~ "Very severe"
)) %>%
mutate(Prop = round((Freq/nrow(df_stats)) * 100))
plot <- ggplot(data = access_to_finance_counts, aes(x = "", y = Prop, fill = AccessToFinance)) +
geom_bar(stat = "identity", width = 1, color = "white") +
geom_text(aes(x = 1.2, label = paste0(AccessToFinance, "\n", Prop, "%")), position = position_stack(vjust = 0.5)) +
coord_polar(theta = "y") +
theme_minimal() +
theme(
legend.position = "none",
axis.text = element_blank(),
axis.title = element_blank()
)
ggsave("Mexico/output/AllFirms_AccessToFinance.png", plot, w = 1200, h = 800, units = "px", bg = "white")
#-------------------------------------------------------------------------------
# Script: efficiency_regs.R
# Author: Nolan Young Zabala
# Description: - energy efficiency regressions Mexico
#-------------------------------------------------------------------------------
# Libraries
library(haven)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stargazer)
# Import data
setwd("C:/Users/young/OneDrive/Escritorio/wbfirmmitigation_snapshots")
master <- haven::read_dta("master.dta") %>%
filter(country == "Mexico2023")
# Construct inefficiency indicator
master$energy_inefficiency_elec <- master$n2b/master$d2
# Define list of relevant regression vars
regvars <- c("country", "countryname", "year", "idstd", "wt", "region", # Identifier and weights
"d2", "l1", "n2a", "n2b", "f1", "c6", "k4", # Firm performance indicators
"a2x", "stra_sector", # Region and sector
"b5", "size", "e1", # Age, size, and market served
"k30", "j30c", "j30f", "d30b", "l30a", # Business environment variables
"k6", "k7", "k8", # Banking variables
"c8", "c9a", "c16", "c17", "c30a", "d30a", "c15", # Infrastructure variables
"d12a", # Supply chains
"j4", "j2", "j7b", # Freq meetings tax officials / % time spent complying with regulations / informal payments
"b7", "b7a"  # Management variables
)
# Subset and rename these vars
reg_master <- master %>%
dplyr::select(all_of(regvars)) %>%
rename(sales = d2) %>%
rename(workers = l1) %>%
rename(wages = n2a) %>%
rename(electricity_cost = n2b) %>%
rename(capital_utilization = f1) %>%
rename(power_outages = c6) %>%
rename(invest_fixed_assets_dummy = k4) %>%
rename(world_region = region) %>%
rename(region = a2x) %>%
rename(sector = stra_sector) %>%
rename(year_founded = b5) %>%
rename(market_served = e1) %>%
rename(obstacle_accesstofinance = k30) %>%
rename(obstacle_businesslicensing = j30c) %>%
rename(obstacle_corruption = j30f) %>%
rename(obstacle_traderegulations = d30b) %>%
rename(obstacle_laborregulations = l30a) %>%
rename(checking_savings_account = k6) %>%
rename(overdraft_facility = k7) %>%
rename(financial_inst_credit = k8) %>%
rename(length_power_outage = c8) %>%
rename(pcnt_sales_losses_dueto_power_outages = c9a) %>%
rename(freq_water_shortages = c16) %>%
rename(length_water_shortages = c17) %>%
rename(obstacle_electricity = c30a) %>%
rename(obstacle_transport = d30a) %>%
rename(insufficient_water_supply = c15) %>%
rename(inputs_domestic = d12a) %>%
rename(freq_meetings_tax_officials = j4) %>%
rename(pcnt_time_dealing_regulations = j2) %>%
rename(total_annual_informal_payments = j7b) %>%
rename(manager_experience_yrs = b7) %>%
rename(top_manager_female = b7a)
# Define some important variables
# Sales per worker
reg_master$sales_per_worker <- reg_master$sales/reg_master$workers
# Energy intensity
reg_master$energy_intensity <- reg_master$electricity_cost/reg_master$sales
reg_master <- reg_master %>%
mutate(energy_intensity = case_when(
energy_intensity < 0 ~ NA,
energy_intensity >= 0 ~ energy_intensity
))
# Age
reg_master <- reg_master %>%
mutate(age = year - year_founded) %>%
mutate(young = case_when(
age <= 5 ~ 1,
age > 5 ~ 0
))
# Size
reg_master <- reg_master %>%
mutate(small = case_when(
size == 1 ~ 1,
size > 1 ~ 0
))
# Market served
reg_master <- reg_master %>%
mutate(market_served = case_when(
market_served == 1 ~ "Local",
market_served == 2 ~ "National",
market_served == 3 ~ "International"
))
reg_master$market_served <- as.factor(reg_master$market_served)
# Inputs domestic
reg_master <- reg_master %>%
mutate(inputs_domestic = case_when(
inputs_domestic > 50 ~ 1,
inputs_domestic <= 50 ~ 0
))
# Re-code the binary vars to 0/1
reg_master <- reg_master %>%
mutate(overdraft_facility = case_when(
overdraft_facility == 1 ~ 1,
overdraft_facility == 2 ~ 0
)) %>%
mutate(insufficient_water_supply = case_when(
insufficient_water_supply == 1 ~ 1,
insufficient_water_supply == 2 ~ 0
))
# Convert obstacle vars to dummies
obstacle_vars <- grep("^obstacle", names(reg_master), value = TRUE)
for (var in obstacle_vars) {
reg_master <- reg_master %>%
mutate(!!var := case_when(
.[[var]] == 0 ~ 0,
.[[var]] == 1 ~ 0,
.[[var]] == 2 ~ 1,
.[[var]] == 3 ~ 1,
.[[var]] == 4 ~ 1
))
}
# Define NAs properly
reg_master[reg_master == -9] <- NA
reg_master[reg_master == -8] <- NA
reg_master[reg_master == -7] <- NA
library(haven)
cd
setwd("C:/Users/young/OneDrive/Documentos")
setwd("C:/Users/young/OneDrive/Documents")
bla <- read_dta("Egyptian Industrial Firm Behavior Survey 2020-2021.dta")
View(bla)
